<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÃ¢n bay MÃ´ phá»ng - é£è¡Œæ¨¡æ‹Ÿæ¸¸æˆ 2.3.5 (Full Code)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --airline-blue: #00529B;
            --airline-blue-dark: #003a6d;
            --accent-yellow: #FFC107;
            --background-grey: #F0F2F5;
            --text-dark: #212529;
            --text-light: #6c757d;
            --success-green: #28a745;
            --danger-red: #dc3545;
            --white: #FFFFFF;
            --border-color: #dee2e6;
            --font-family: 'Inter', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-grey);
            margin: 0;
            padding: 20px;
            color: var(--text-dark);
        }

        .lang-vi { display: none; color: var(--text-light); font-weight: 400; margin-left: 5px; }
        body.show-vietnamese .lang-vi { display: inline; }
        
        .game-wrapper { max-width: 1400px; margin: auto; }
        .main-header { text-align: center; color: var(--airline-blue); font-size: 2.2rem; font-weight: 700; margin-bottom: 2rem; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem; background: var(--white); padding: 10px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .tab-button { padding: 10px 25px; margin: 5px; cursor: pointer; border: 2px solid transparent; background-color: transparent; color: var(--text-light); border-radius: 30px; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
        .tab-button:hover { background-color: #e9ecef; }
        .tab-button.active { background-color: var(--airline-blue); color: var(--white); border-color: var(--airline-blue); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .role-container { display: grid; grid-template-columns: 380px 1fr; gap: 2rem; background: var(--white); padding: 2rem; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); }
        .instructions-panel { background-color: #f8f9fa; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-color); height: fit-content; }
        .instructions-panel h3 { margin-top: 0; color: var(--airline-blue); border-bottom: 2px solid var(--airline-blue); padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .instructions-panel ul { padding-left: 20px; list-style-type: 'ğŸ’¬'; padding-left: 25px; }
        .instructions-panel li { margin-bottom: 10px; padding-left: 10px; }
        .interaction-panel { padding: 1rem; }
        .interaction-panel h3 { margin-top: 0; font-size: 1.5rem; color: var(--text-dark); text-align: center; margin-bottom: 2rem; }
        .card { background: #fdfdff; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .card h4, .card h5 { margin-top: 0; font-size: 1.1rem; color: var(--airline-blue-dark); }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-light); }
        .form-group input[type="text"], .form-group input[type="date"], .form-group input[type="number"] { width: calc(100% - 22px); padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; font-family: var(--font-family); }
        .gender-select { display: flex; gap: 1rem; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; color: var(--white); cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn-primary { background-color: var(--airline-blue); }
        .btn-success { background-color: var(--success-green); }

        /* Passenger UI */
        #passport-display { display: flex; gap: 20px; padding: 20px; background: linear-gradient(to right, #eaf5ff, #f0f8ff); border: 1px solid var(--border-color); border-radius: 12px; align-items: center; }
        #passport-photo { width: 120px; height: 150px; object-fit: cover; border-radius: 8px; border: 3px solid var(--white); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #passenger-summary { margin-top: 1.5rem; padding: 1.5rem; border: 2px dashed var(--accent-yellow); background-color: #fffbeb; border-radius: 12px; }
        .luggage-packing-area { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

        /* Check-in UI */
        .checkin-app { background: var(--white); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); padding: 2rem; }
        .checkin-app .input-group { display: flex; gap: 1rem; align-items: flex-end; }
        .results-area { margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; min-height: 100px; }
        .seat-map { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 15px; padding: 1rem; background: #e9ecef; border-radius: 8px; }
        .seat { height: 35px; line-height: 35px; text-align: center; border: 1px solid var(--text-light); border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .seat.aisle { border: none; background: transparent; }
        .seat.available { background: var(--white); }
        .seat.occupied { background: var(--text-light); color: var(--white); cursor: not-allowed; }
        .seat.selected { background: var(--airline-blue); color: var(--white); }
        .boarding-pass { border: 2px dashed var(--airline-blue); padding: 1rem; margin-top: 1rem; background: #f0f8ff; }
        .flight-route { font-size: 1.2rem; font-weight: 600; }
        
        /* Check-in Animation */
        .luggage-animation-area { position: relative; height: 150px; background-color: #e9ecef; border-radius: 8px; margin-top: 1.5rem; border: 1px solid var(--border-color); overflow: hidden; }
        .weighing-scale { position: absolute; width: 120px; height: 40px; background-color: #adb5bd; bottom: 0; left: 80px; border-top: 2px solid #6c757d; border-left: 2px solid #6c757d; border-right: 2px solid #6c757d; border-top-left-radius: 5px; border-top-right-radius: 5px; }
        #scale-display { position: absolute; top: 5px; left: 50%; transform: translateX(-50%); background-color: #000; color: var(--success-green); font-family: 'Courier New', monospace; padding: 2px 8px; border-radius: 3px; font-size: 0.9rem; font-weight: bold; }
        .conveyor-belt-checkin { position: absolute; width: 70%; height: 25px; background-color: #343a40; background-image: repeating-linear-gradient(-45deg, #495057, #495057 10px, #343a40 10px, #343a40 20px); background-size: 28px 28px; bottom: 0; left: 200px; animation: scroll-belt 1s linear infinite; animation-play-state: paused; }
        .conveyor-belt-checkin.running { animation-play-state: running; }
        @keyframes scroll-belt { from { background-position: 0 0; } to { background-position: 28px 0; } }
        .animated-suitcase { position: absolute; width: 80px; height: 100px; bottom: 40px; left: 100px; opacity: 0; transform: translateY(50px) scale(0.8); transition: all 0.8s ease-in-out; }
        .animated-suitcase.on-scale { opacity: 1; transform: translateY(0) scale(1); }
        .animated-suitcase.on-conveyor { left: 450px; transform: scale(0.7); transition-duration: 2.5s; }

        /* Security UI */
        .scanner-conveyor { width: 100%; height: 250px; background: #222; border: 2px solid #555; border-radius: 10px; margin: 1rem auto; position: relative; overflow: hidden; }
        #scan-result-screen { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .scanner-beam { width: 5px; height: 110%; background: rgba(255, 0, 0, 0.5); box-shadow: 0 0 15px 5px rgba(255, 0, 0, 0.5); position: absolute; top: -5%; left: -10px; }
        .scanner-beam.scanning { animation: scan-horizontal 2s linear; }
        @keyframes scan-horizontal { from { left: -10px; } to { left: 102%; } }
        #scanned-luggage-bg { height: 200px; opacity: 0; transition: opacity 0.5s; }
        .scanned-item { position: absolute; filter: invert(1) brightness(1.5) contrast(2) hue-rotate(90deg); opacity: 0; transition: opacity 0.5s; }
        #item-laptop { width: 150px; top: 30px; left: 100px; }
        #item-phone { width: 60px; top: 150px; left: 80px; }
        #item-powerbank { width: 70px; top: 170px; left: 200px; }
        #suspicious-item-box { position: absolute; border: 3px dashed var(--danger-red); display: none; animation: blink 1s infinite; }
        @keyframes blink { 50% { border-color: transparent; } }
        .action-log { text-align: left; background: #222; color: #eee; padding: 1rem; border-radius: 8px; margin-top: 1rem; font-family: 'Courier New', monospace; }

        /* Vietnamese Toggle Switch */
        .language-toggle { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: "VI"; color: var(--text-dark); height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        input:checked + .slider { background-color: var(--airline-blue); }
        input:checked + .slider:before { transform: translateX(26px); }
    </style>
</head>
<body>
    <div class="language-toggle">
        <label class="switch">
            <input type="checkbox" onchange="toggleVietnamese(this.checked)">
            <span class="slider"></span>
        </label>
    </div>

    <div class="game-wrapper">
        <h1 class="main-header">é£è¡Œæ¨¡æ‹Ÿæ¸¸æˆ <span class="lang-vi">SÃ¢n bay MÃ´ phá»ng 2.3.5</span></h1>
        <div class="tabs">
            <button class="tab-button active" onclick="switchRole('Passenger')">ä¹˜å®¢ <span class="lang-vi">HÃ nh khÃ¡ch</span></button>
            <button class="tab-button" onclick="switchRole('CheckIn')">å€¼æœºå‘˜ <span class="lang-vi">Check-in</span></button>
            <button class="tab-button" onclick="switchRole('Security')">å®‰æ£€å‘˜ <span class="lang-vi">An ninh</span></button>
            <button class="tab-button" onclick="switchRole('FlightAttendant')">ä¹˜åŠ¡å‘˜ <span class="lang-vi">Tiáº¿p viÃªn</span></button>
        </div>

        <div id="Passenger" class="tab-content active">
            <div class="role-container">
                <aside class="instructions-panel">
                    <h3>ä¹˜å®¢ä»»åŠ¡ <span class="lang-vi">Nhiá»‡m vá»¥ cá»§a HÃ nh khÃ¡ch</span></h3>
                    <ol>
                        <li>åŠç†æŠ¤ç…§ <span class="lang-vi">Táº¡o há»™ chiáº¿u.</span></li>
                        <li>æ”¶æ‹¾è¡Œæ <span class="lang-vi">ÄÃ³ng gÃ³i hÃ nh lÃ½.</span></li>
                        <li><strong>æŠŠ â€œèˆªç­ä¿¡æ¯â€ æˆªå›¾å‘ç»™å€¼æœºå‘˜ã€‚</strong><span class="lang-vi"><strong>Chá»¥p áº£nh mÃ n hÃ¬nh "ThÃ´ng tin Chuyáº¿n bay"</strong> gá»­i cho NhÃ¢n viÃªn Check-in.</span></li>
                        <li>åˆ°å€¼æœºæŸœå°è¯´ï¼š`ä½ å¥½ï¼æˆ‘è¦<strong>æŠŠ</strong>æœºç¥¨å’ŒæŠ¤ç…§<strong>ç»™ä½ </strong>ã€‚`</li>
                        <li>è¢«é—®åˆ°æ—¶ï¼Œè¯´ï¼š`æˆ‘è¦<strong>æŠŠ</strong>è¿™ä¸ªç®±å­<strong>æ‰˜è¿</strong>ã€‚`</li>
                    </ol>
                </aside>
                <main class="interaction-panel">
                    <h3>ä¹˜å®¢ç•Œé¢ <span class="lang-vi">Giao diá»‡n cá»§a HÃ nh khÃ¡ch</span></h3>
                    <div class="card">
                        <h4>1. åŠæŠ¤ç…§ <span class="lang-vi">Táº¡o Há»™ chiáº¿u</span></h4>
                        <div class="form-group"><label>å§“å <span class="lang-vi">Há» vÃ  tÃªn</span></label><input type="text" id="name" placeholder="ä¾‹å¦‚: NGUYEN VAN A"></div>
                        <div class="form-group"><label>å‡ºç”Ÿæ—¥æœŸ <span class="lang-vi">NgÃ y sinh</span></label><input type="date" id="dob"></div>
                        <div class="form-group"><label>æ€§åˆ« <span class="lang-vi">Giá»›i tÃ­nh</span></label>
                            <div class="gender-select">
                                <label><input type="radio" name="gender" value="male" checked> ç”· <span class="lang-vi">Nam</span></label>
                                <label><input type="radio" name="gender" value="female"> å¥³ <span class="lang-vi">Ná»¯</span></label>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="createPassport()">åŠå¥½æŠ¤ç…§ <span class="lang-vi">Táº¡o Há»™ chiáº¿u</span></button>
                    </div>
                     <div class="card">
                        <h4>2. æ”¶æ‹¾è¡Œæ <span class="lang-vi">ÄÃ³ng gÃ³i HÃ nh lÃ½</span></h4>
                        <div class="luggage-packing-area">
                            <div>
                                <h5>æ‰˜è¿è¡Œæ <span class="lang-vi">HÃ nh lÃ½ kÃ½ gá»­i</span></h5>
                                <div id="checked-luggage-list"></div>
                                <p><strong>é‡é‡ <span class="lang-vi">CÃ¢n náº·ng</span>: <span id="checked-weight">0.0</span> kg</strong></p>
                            </div>
                            <div>
                                <h5>æ‰‹æè¡Œæ <span class="lang-vi">HÃ nh lÃ½ xÃ¡ch tay</span></h5>
                                <div id="carry-on-luggage-list"></div>
                            </div>
                        </div>
                    </div>
                    <div id="passenger-summary" style="display:none;">
                        <h4 style="text-align:center; color: var(--danger-red);">è¯·æˆªå›¾æ­¤éƒ¨åˆ† <span class="lang-vi">CHá»¤P áº¢NH MÃ€N HÃŒNH NÃ€Y</span></h4>
                        <div id="passport-display">
                            <img id="passport-photo">
                            <div id="passport-info">
                                <p><strong>å§“å:</strong> <span id="p-name"></span></p>
                                <p><strong>å‡ºç”Ÿæ—¥æœŸ:</strong> <span id="p-dob"></span></p>
                                <p><strong>é¢„è®¢ä»£ç :</strong> <span id="p-booking"></span></p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        
        <div id="CheckIn" class="tab-content">
             <div class="role-container">
                <aside class="instructions-panel">
                    <h3>å€¼æœºå‘˜ä»»åŠ¡ <span class="lang-vi">Nhiá»‡m vá»¥ cá»§a NhÃ¢n viÃªn Check-in</span></h3>
                    <ol>
                        <li>æ”¶åˆ°ä¹˜å®¢çš„æˆªå›¾ <span class="lang-vi">Nháº­n áº£nh chá»¥p mÃ n hÃ¬nh tá»« HÃ nh khÃ¡ch.</span></li>
                        <li>è·Ÿä¹˜å®¢æ‰“æ‹›å‘¼: `ä½ å¥½ï¼è¯·<strong>æŠŠ</strong>æ‚¨çš„æŠ¤ç…§ç»™æˆ‘çœ‹çœ‹ã€‚`</li>
                        <li>è¾“å…¥ä¹˜å®¢çš„ä¿¡æ¯ <span class="lang-vi">Nháº­p thÃ´ng tin khÃ¡ch vÃ o há»‡ thá»‘ng.</span></li>
                        <li>è®©ä¹˜å®¢æ‰˜è¿ä»–ä»¬çš„è¡Œæ: `è¯·<strong>æŠŠ</strong>è¦æ‰˜è¿çš„è¡Œæ<strong>æ”¾ä¸Šæ¥</strong>ã€‚`</li>
                        <li>æ‰“å°ç™»æœºç‰Œ: `è¿™æ˜¯æ‚¨çš„ç™»æœºç‰Œï¼Œè¯·<strong>æ‹¿å¥½</strong>ã€‚`</li>
                    </ol>
                </aside>
                <main class="interaction-panel">
                    <h3>å€¼æœºç³»ç»Ÿ <span class="lang-vi">Há»‡ thá»‘ng lÃ m thá»§ tá»¥c</span> (DCS)</h3>
                    <div class="checkin-app">
                        <div class="input-group">
                             <div class="form-group" style="flex:1;"><label>é¢„è®¢ä»£ç  <span class="lang-vi">MÃ£ Ä‘áº·t chá»—</span></label><input type="text" id="booking-ref" placeholder="è¾“å…¥ä»£ç ..."></div>
                            <div class="form-group" style="flex:2;"><label>ä¹˜å®¢å§“å <span class="lang-vi">TÃªn hÃ nh khÃ¡ch</span></label><input type="text" id="passenger-name" placeholder="è¾“å…¥å§“å..."></div>
                            <button class="btn btn-primary" onclick="findPassenger()">æŸ¥æ‰¾ <span class="lang-vi">Tra cá»©u</span></button>
                        </div>
                         <div class="input-group" style="margin-top:1rem;">
                            <div class="form-group" style="flex:1;"><label>è¡Œæé‡é‡ <span class="lang-vi">CÃ¢n náº·ng (kg)</span></label><input type="number" id="luggage-weight" placeholder="è¾“å…¥é‡é‡..."></div>
                             <button class="btn btn-primary" onclick="checkLuggage()">æ£€æŸ¥è¡Œæ <span class="lang-vi">Kiá»ƒm tra</span></button>
                        </div>
                        
                        <div class="luggage-animation-area">
                            <div class="weighing-scale">
                                <div id="scale-display">0.0 kg</div>
                            </div>
                            <div class="conveyor-belt-checkin" id="conveyor-belt"></div>
                            <img src="https://product.hstatic.net/1000079290/product/2_0012__dsc9961_copy_f03ca78b030c42fc980ed2d0b0191f1a_master.jpg" class="animated-suitcase">
                        </div>
                        
                        <div class="results-area" id="checkin-results"></div>
                        <h4>é€‰åº§ä½ <span class="lang-vi">Chá»n chá»— ngá»“i</span></h4>
                        <div class="seat-map" id="seat-map-checkin"></div>
                        <div style="text-align:center; margin-top:1.5rem;"><button class="btn btn-success" onclick="issueBoardingPass()">æ‰“å°ç™»æœºç‰Œ <span class="lang-vi">In Tháº»</span></button></div>
                        <div id="boarding-pass-area"></div>
                    </div>
                </main>
            </div>
        </div>

        <div id="Security" class="tab-content">
             <div class="role-container">
                <aside class="instructions-panel">
                     <h3>å®‰æ£€å‘˜ä»»åŠ¡ <span class="lang-vi">Nhiá»‡m vá»¥ cá»§a NhÃ¢n viÃªn An ninh</span></h3>
                    <ol>
                        <li>è¦æ±‚ä¹˜å®¢: `è¯·<strong>æŠŠ</strong>ç”µè„‘ã€æ‰‹æœºå’Œå……ç”µå®éƒ½<strong>æ‹¿å‡ºæ¥</strong>ã€‚` <span class="lang-vi">(Sáº¡c dá»± phÃ²ng: å……ç”µå® chÅngdiÃ nbÇo)</span></li>
                        <li>æ“ä½œæ‰«æä»ª <span class="lang-vi">Váº­n hÃ nh mÃ¡y soi chiáº¿u.</span></li>
                        <li>å¦‚æœå‘ç°å¯ç–‘ç‰©å“ï¼Œè¦æ±‚å¼€åŒ…æ£€æŸ¥: `å¯¹ä¸èµ·ï¼Œè¯·<strong>æŠŠ</strong>æ‚¨çš„åŒ…<strong>æ‰“å¼€</strong>ã€‚`</li>
                    </ol>
                </aside>
                <main class="interaction-panel">
                    <h3>å®‰æ£€ç«™ <span class="lang-vi">Tráº¡m kiá»ƒm tra An ninh</span></h3>
                    <div class="card">
                        <button class="btn btn-primary" onclick="startScan()">å¼€å§‹æ‰«æ <span class="lang-vi">Báº¯t Ä‘áº§u soi chiáº¿u</span></button>
                        <div class="scanner-conveyor">
                            <div id="scan-result-screen"></div>
                        </div>
                        <div class="action-log" id="security-log">å®‰æ£€æ—¥å¿—:<br><span class="lang-vi">NHáº¬T KÃ AN NINH:</span><br></div>
                    </div>
                </main>
            </div>
        </div>
        
        <div id="FlightAttendant" class="tab-content">
            <div class="role-container">
                 <aside class="instructions-panel">
                     <h3>ä¹˜åŠ¡å‘˜ä»»åŠ¡ <span class="lang-vi">Nhiá»‡m vá»¥ cá»§a Tiáº¿p viÃªn</span></h3>
                    <ol>
                        <li>èµ·é£å‰å¹¿æ’­: `å¥³å£«ä»¬ï¼Œå…ˆç”Ÿä»¬ï¼è¯·å¤§å®¶<strong>æŠŠ</strong>å®‰å…¨å¸¦<strong>ç³»å¥½</strong>ï¼Œ<strong>æŠŠ</strong>æ‰‹æœº<strong>å…³ä¸Š</strong>ã€‚`</li>
                        <li>è¯¢é—®ä¹˜å®¢éœ€æ±‚: `ä½ å¥½ï¼Œä½ æƒ³åƒç‚¹å„¿ä»€ä¹ˆæˆ–è€…å–ç‚¹å„¿ä»€ä¹ˆï¼Ÿ`</li>
                    </ol>
                 </aside>
                 <main class="interaction-panel">
                    <h3>ä¹˜åŠ¡å‘˜å¹³æ¿ <span class="lang-vi">Báº£ng Ä‘iá»u khiá»ƒn (Tablet)</span></h3>
                    <div class="card menu-card">
                         <h4>ä»Šæ—¥èœå• <span class="lang-vi">Thá»±c Ä‘Æ¡n hÃ´m nay</span> (VJ123)</h4>
                         <h5>ä¸»é£Ÿ <span class="lang-vi">MÃ³n chÃ­nh</span></h5>
                         <ul>
                             <li>è¶Šå—ç‰›è‚‰æ²³ç²‰ <span class="lang-vi">Phá»Ÿ bÃ² Viá»‡t Nam</span></li>
                             <li>æµ·å—é¸¡é¥­ <span class="lang-vi">CÆ¡m gÃ  Háº£i Nam</span></li>
                         </ul>
                         <h5>é¥®æ–™ <span class="lang-vi">Äá»“ uá»‘ng</span></h5>
                         <ul>
                             <li>æ¤°å­æ°´ <span class="lang-vi">NÆ°á»›c dá»«a</span></li>
                             <li>è²èŠ±èŒ¶ <span class="lang-vi">TrÃ  sen</span></li>
                             <li>å†°å¥¶å’–å•¡ <span class="lang-vi">CÃ  phÃª sá»¯a Ä‘Ã¡</span></li>
                         </ul>
                    </div>
                 </main>
            </div>
        </div>
    </div>

<script>
    // --- Global Data & Config ---
    const passengerProfile = { name: '', dob: '', bookingRef: '', carryOnItems: [], checkedWeight: 0 };
    const checkinData = { passengerFound: false, seat: null };
    const malePhotos = ['https://danviet.ex-cdn.com/files/f1/296231569849192448/2022/7/18/z3575814842290f4a344b1db566b37fa96b7a2550a9801-1658133352416631936514.jpg', 'https://media-cdn-v2.laodong.vn/storage/newsportal/2023/9/26/1246534/Hua-Quang-Han-1B.jpeg'];
    const femalePhotos = ['https://images2.thanhnien.vn/528068263637045248/2025/5/27/doan-di-bang-3-17483305857971154397203.jpg', 'https://m.media-amazon.com/images/M/MV5BYWYwYzYzMjUtNWE0MS00NmJlLTljNGMtNzliYjg5NzQ1OWY5XkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg'];
    const itemData = {
        checked: [{ name: 'è¡£æœ', vi: '(Quáº§n Ã¡o)', weight: 7.0 }, { name: 'ä¹¦', vi: '(SÃ¡ch)', weight: 2.5 }],
        carryOn: [{ name: 'ç¬”è®°æœ¬ç”µè„‘', vi: '(Laptop)', id: 'laptop' }, { name: 'æ‰‹æœº', vi: '(Äiá»‡n thoáº¡i)', id: 'phone' }, { name: 'å……ç”µå®', vi: '(Sáº¡c dá»± phÃ²ng)', id: 'powerbank' }]
    };

    // --- Core UI Functions ---
    function toggleVietnamese(show) { document.body.classList.toggle('show-vietnamese', show); }
    function switchRole(roleName) {
        document.querySelectorAll('.tab-content, .tab-button').forEach(el => el.classList.remove('active'));
        document.getElementById(roleName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- Passenger Logic ---
    function createPassport() {
        const name = document.getElementById('name').value.toUpperCase();
        if (!name) { alert('è¯·è¾“å…¥æ‚¨çš„å§“å! (Vui lÃ²ng Ä‘iá»n tÃªn!)'); return; }
        passengerProfile.name = name;
        passengerProfile.dob = document.getElementById('dob').value;
        passengerProfile.bookingRef = 'WXYZ' + Math.floor(Math.random() * 90 + 10);
        
        const gender = document.querySelector('input[name="gender"]:checked').value;
        const photoArray = gender === 'male' ? malePhotos : femalePhotos;
        document.getElementById('passport-photo').src = photoArray[Math.floor(Math.random() * photoArray.length)];
        
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-dob').innerText = passengerProfile.dob;
        document.getElementById('p-booking').innerText = passengerProfile.bookingRef;
        document.getElementById('passenger-summary').style.display = 'block';
    }
    function updateLuggage() {
        let totalWeight = 0;
        document.querySelectorAll('#checked-luggage-list input:checked').forEach(cb => totalWeight += parseFloat(cb.value));
        passengerProfile.checkedWeight = totalWeight;
        document.getElementById('checked-weight').innerText = totalWeight.toFixed(1);

        passengerProfile.carryOnItems = [];
        document.querySelectorAll('#carry-on-luggage-list input:checked').forEach(cb => passengerProfile.carryOnItems.push(cb.value));
    }

    // --- Check-in Logic ---
    const checkinLog = document.getElementById('checkin-results');
    function findPassenger() {
        const nameInput = document.getElementById('passenger-name').value.toUpperCase();
        if (!nameInput) { checkinLog.innerHTML = `<p style="color:red;">âŒ è¯·è¾“å…¥ä¹˜å®¢å§“åã€‚</p>`; return; }
        checkinLog.innerHTML = `<p style="color:green;">âœ… æ­£åœ¨å¤„ç†ä¹˜å®¢: ${nameInput} çš„ä¿¡æ¯ã€‚</p>`;
        checkinData.passengerFound = true;
    }

    function checkLuggage() {
        const weightInput = parseFloat(document.getElementById('luggage-weight').value);
        const suitcase = document.querySelector('#CheckIn .animated-suitcase');
        const scaleDisplay = document.getElementById('scale-display');
        const conveyor = document.getElementById('conveyor-belt');

        suitcase.classList.remove('on-scale', 'on-conveyor');
        conveyor.classList.remove('running');
        scaleDisplay.textContent = '0.0 kg';
        checkinLog.innerHTML = '';
        
        void suitcase.offsetWidth; 

        suitcase.classList.add('on-scale');
        
        setTimeout(() => {
            if (isNaN(weightInput)) {
                checkinLog.innerHTML += '<p style="color:red;">è¯·è¾“å…¥æœ‰æ•ˆçš„é‡é‡ã€‚</p>';
                suitcase.classList.remove('on-scale');
                return;
            }

            let currentWeight = 0;
            const interval = setInterval(() => {
                currentWeight += 1.7;
                if (currentWeight >= weightInput) {
                    currentWeight = weightInput;
                    clearInterval(interval);
                }
                scaleDisplay.textContent = currentWeight.toFixed(1) + ' kg';
            }, 50);

            setTimeout(() => {
                checkinLog.innerHTML += `<p>æœ€ç»ˆé‡é‡ <span class="lang-vi">Trá»ng lÆ°á»£ng cuá»‘i cÃ¹ng</span>: ${weightInput.toFixed(1)} kgã€‚</p>`;
                const isOverweight = weightInput > 20.0;
                checkinLog.innerHTML += isOverweight ? '<p style="color:red;">âš ï¸ è¡Œæè¶…é‡!</p>' : '<p style="color:green;">âœ… è¡Œæé‡é‡åˆæ ¼ã€‚</p>';

                if (!isOverweight) {
                    setTimeout(() => {
                        checkinLog.innerHTML += '<p>è¡Œææ­£åœ¨ä¼ é€... <span class="lang-vi">HÃ nh lÃ½ Ä‘ang Ä‘Æ°á»£c chuyá»ƒn Ä‘i...</span></p>';
                        conveyor.classList.add('running');
                        suitcase.classList.add('on-conveyor');
                        
                        setTimeout(() => {
                           suitcase.classList.remove('on-scale', 'on-conveyor');
                           conveyor.classList.remove('running');
                        }, 2500);
                    }, 1000);
                }
            }, 1500); 
        }, 800);
    }
    
    function issueBoardingPass() {
        if (!checkinData.seat) { alert('è¯·ä¸ºä¹˜å®¢é€‰åº§ä½! (Vui lÃ²ng chá»n chá»— ngá»“i!)'); return; }
        const name = document.getElementById('passenger-name').value.toUpperCase();
        document.getElementById('boarding-pass-area').innerHTML = `<div class="boarding-pass"><h4 style="color: var(--airline-blue);">ç™»æœºç‰Œ <span class="lang-vi">BOARDING PASS</span></h4><p><strong>èˆªç­ <span class="lang-vi">Flight</span>:</strong> VJ123</p><p class="flight-route">èƒ¡å¿—æ˜å¸‚ (SGN) -> åŒ—äº¬ (PEK)</p><p><strong>æ—…å®¢ <span class="lang-vi">Passenger</span>:</strong> ${name}</p><p><strong>åº§ä½ <span class="lang-vi">Seat</span>:</strong> ${checkinData.seat}</p><p><strong>ç™»æœºæ—¶é—´ <span class="lang-vi">Boarding Time</span>:</strong> 18:30</p></div>`;
    }

    // --- Security Logic ---
    const securityLog = document.getElementById('security-log');
    function startScan() {
        const screen = document.getElementById('scan-result-screen');
        securityLog.innerHTML = 'å®‰æ£€æ—¥å¿—:<br><span class="lang-vi">NHáº¬T KÃ AN NINH:</span><br>> å¼€å§‹æ‰«æ...';
        
        let beam = document.createElement('div');
        beam.className = 'scanner-beam scanning';
        screen.innerHTML = '';
        screen.appendChild(beam);
        
        setTimeout(() => {
            beam.remove();
            let screenHTML = `<img id="scanned-luggage-bg" src="https://product.hstatic.net/1000079290/product/2_0012__dsc9961_copy_f03ca78b030c42fc980ed2d0b0191f1a_master.jpg" style="opacity: 0.5; height: 200px;">`;
            screen.innerHTML = screenHTML;

            const itemsInScan = passengerProfile.carryOnItems;
            if (itemsInScan.length === 0) {
                securityLog.innerHTML += '<div>> è¡Œæä¸­æ²¡æœ‰ç”µå­äº§å“ã€‚<span class="lang-vi">KhÃ´ng cÃ³ Ä‘á»“ Ä‘iá»‡n tá»­. An toÃ n.</span></div>';
                return;
            }

            let itemElements = '';
            itemsInScan.forEach(id => {
                let src = '';
                if (id === 'laptop') src = 'https://atpro.com.vn/wp-content/uploads/2024/02/laptop-la-gi-may-tinh-xach-tay-la-gi1.jpeg';
                if (id === 'phone') src = 'https://product.hstatic.net/1000406564/product/iphone11-tr_3064909d9a634a548fb3657c570f5c80_master.jpg';
                if (id === 'powerbank') src = 'https://hanoicomputercdn.com/media/product/72608_pin_sac_du_phong_akus_dp150_10_000_5.png';
                itemElements += `<img id="item-${id}" class="scanned-item" src="${src}">`;
            });
            screen.innerHTML += itemElements + `<div id="suspicious-item-box"></div>`;
            
            document.querySelectorAll('.scanned-item').forEach(el => el.style.opacity = '1');

            const suspiciousItemId = itemsInScan[Math.floor(Math.random() * itemsInScan.length)];
            const suspiciousItemElement = document.getElementById(`item-${suspiciousItemId}`);
            const suspiciousBox = document.getElementById('suspicious-item-box');
            
            suspiciousBox.style.left = suspiciousItemElement.offsetLeft + 'px';
            suspiciousBox.style.top = suspiciousItemElement.offsetTop + 'px';
            suspiciousBox.style.width = suspiciousItemElement.offsetWidth + 'px';
            suspiciousBox.style.height = suspiciousItemElement.offsetHeight + 'px';
            suspiciousBox.style.display = 'block';

            const suspiciousItemName = itemData.carryOn.find(i => i.id === suspiciousItemId).name;
            securityLog.innerHTML += `<div style="color:#ffc107;">> [è­¦å‘Š] å‘ç°å¯ç–‘ç‰©å“ (${suspiciousItemName})ã€‚<span class="lang-vi">[Cáº¢NH BÃO] PhÃ¡t hiá»‡n váº­t thá»ƒ Ä‘Ã¡ng ngá».</span></div>`;
        }, 2000);
    }
    
    // --- Initialization ---
    function initialize() {
        document.getElementById('checked-luggage-list').innerHTML = itemData.checked.map(item => `<div><label><input type="checkbox" onchange="updateLuggage()" value="${item.weight}"> ${item.name} <span class="lang-vi">${item.vi}</span></label></div>`).join('');
        document.getElementById('carry-on-luggage-list').innerHTML = itemData.carryOn.map(item => `<div><label><input type="checkbox" onchange="updateLuggage()" value="${item.id}" checked> ${item.name} <span class="lang-vi">${item.vi}</span></label></div>`).join('');
        updateLuggage();

        const createSeatMap = (containerId, isInteractive) => {
            const container = document.getElementById(containerId); container.innerHTML = '';
            const rows = ['A', 'B', 'C', '', 'D', 'E', 'F'];
            for (let i = 1; i <= 10; i++) {
                rows.forEach(row => {
                    const seat = document.createElement('div');
                    if (row === '') { seat.classList.add('aisle'); seat.innerText = i; } 
                    else {
                        seat.classList.add('seat'); seat.innerText = i + row;
                        if (Math.random() > 0.65) { seat.classList.add('occupied'); } 
                        else {
                            seat.classList.add('available');
                            if (isInteractive) {
                                seat.onclick = function() {
                                    if (!checkinData.passengerFound) {
                                        alert('è¯·å…ˆæŸ¥æ‰¾ä¹˜å®¢! (Vui lÃ²ng tra cá»©u hÃ nh khÃ¡ch trÆ°á»›c!)');
                                        return;
                                    }
                                    if (this.classList.contains('available')) {
                                        document.querySelectorAll(`#${containerId} .seat.selected`).forEach(s => s.classList.remove('selected'));
                                        this.classList.add('selected');
                                        checkinData.seat = this.innerText;
                                        checkinLog.innerHTML += `<p>å·²é€‰åº§ä½ <span class="lang-vi">ÄÃ£ chá»n gháº¿</span> ${this.innerText}.</p>`;
                                    }
                                };
                            }
                        }
                    }
                    container.appendChild(seat);
                });
            }
        };
        createSeatMap('seat-map-checkin', true);
        createSeatMap('seat-map-fa', false);
    }
    window.onload = initialize;
</script>

</body>
</html>